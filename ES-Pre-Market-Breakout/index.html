<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-Mini S&P 500 Trading Edge Analysis</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<style>
:root {
  --bg: #FAFAF8;
  --surface: #FFFFFF;
  --surface-alt: #F5F4F0;
  --border: #E8E6E1;
  --border-strong: #D4D1C9;
  --text-primary: #1A1A18;
  --text-secondary: #6B6964;
  --text-muted: #9C9890;
  --accent: #2563EB;
  --accent-light: #EFF6FF;
  --green: #16A34A;
  --green-bg: #DCFCE7;
  --red: #DC2626;
  --red-bg: #FEE2E2;
  --amber: #D97706;
  --amber-light: #FFFBEB;
  --amber-bg: #FEF3C7;
  --purple: #7C3AED;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'DM Sans', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text-primary);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

.report {
  max-width: 1400px;
  margin: 0 auto;
  padding: 48px 32px;
}

.header {
  margin-bottom: 48px;
  padding-bottom: 32px;
  border-bottom: 2px solid var(--border);
}

.header-tag {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--accent);
  background: var(--accent-light);
  padding: 4px 12px;
  border-radius: 4px;
  margin-bottom: 16px;
}

.header h1 {
  font-size: 32px;
  font-weight: 700;
  letter-spacing: -0.02em;
  margin-bottom: 8px;
}

.header .subtitle {
  font-size: 16px;
  color: var(--text-secondary);
}

.header .meta {
  display: flex;
  gap: 24px;
  margin-top: 16px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--text-muted);
  flex-wrap: wrap;
}

.meta-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: var(--text-muted);
  opacity: 0.5;
  align-self: center;
}

.charts-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 32px;
  margin-bottom: 48px;
}

.chart-container {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 24px;
  transition: box-shadow 0.2s;
}

.chart-container:hover {
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
}

.chart-title {
  font-size: 16px;
  font-weight: 700;
  letter-spacing: -0.01em;
  margin-bottom: 6px;
  color: var(--text-primary);
}

.chart-subtitle {
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 24px;
  line-height: 1.5;
}

.chart-wrapper {
  position: relative;
  height: 400px;
}

.insights {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 32px;
  margin-top: 40px;
}

.insights-title {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.01em;
  margin-bottom: 24px;
  color: var(--text-primary);
}

.insight-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}

.insight-card {
  background: var(--surface-alt);
  padding: 20px;
  border-radius: 8px;
  border-left: 3px solid var(--accent);
}

.insight-card h3 {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 10px;
  color: var(--text-primary);
}

.insight-card p {
  color: var(--text-secondary);
  line-height: 1.6;
  font-size: 13px;
}

.threshold {
  font-family: 'JetBrains Mono', monospace;
  font-weight: 600;
  color: var(--accent);
}

.probability {
  font-family: 'JetBrains Mono', monospace;
  font-weight: 700;
  color: var(--green);
  font-size: 1.05em;
}

.legend-custom {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 16px;
  flex-wrap: wrap;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--text-secondary);
}

.legend-color {
  width: 14px;
  height: 14px;
  border-radius: 3px;
}

.footer {
  margin-top: 48px;
  padding-top: 24px;
  border-top: 1px solid var(--border);
  font-size: 12px;
  color: var(--text-muted);
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 12px;
}

.section {
  margin-bottom: 48px;
}

.section-title {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.01em;
  margin-bottom: 8px;
}

.section-desc {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 24px;
}

.table-wrap {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 24px;
}

.table-header {
  padding: 16px 20px;
  background: var(--surface-alt);
  border-bottom: 1px solid var(--border);
  font-size: 14px;
  font-weight: 600;
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead th {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--text-muted);
  text-align: left;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  background: var(--surface-alt);
}

thead th.right {
  text-align: right;
}

thead th.center {
  text-align: center;
}

tbody td {
  font-size: 14px;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
}

tbody td.mono {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
}

tbody td.right {
  text-align: right;
}

tbody td.center {
  text-align: center;
}

tbody tr:last-child td {
  border-bottom: none;
}

tbody tr:hover {
  background: rgba(0, 0, 0, 0.015);
}

@media (max-width: 1024px) {
  .charts-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .report {
    padding: 24px 16px;
  }
  .chart-wrapper {
    height: 320px;
  }
}
</style>
</head>
<body>
<div class="report">

  <div class="header">
    <div class="header-tag">◆ Quantitative Research</div>
    <h1>E-Mini S&P 500 Trading Edge Analysis</h1>
    <div class="subtitle">Breakout probability analysis by range size — Globex and Pre-Market sessions</div>
    <div class="meta">
      <span>ES Futures</span>
      <div class="meta-dot"></div>
      <span>1,151 Trading Days</span>
      <div class="meta-dot"></div>
      <span>Range Size as % of ADR</span>
    </div>
  </div>

  <div class="charts-grid">
    <!-- Chart 1: Globex Range - ANY Breakout -->
    <div class="chart-container">
      <h3 class="chart-title">Globex Range - Probability of ANY Breakout</h3>
      <p class="chart-subtitle">How Range Size Impacts the Likelihood of Breaking Out of Globex High or Low [n = 1,151]</p>
      <div class="chart-wrapper">
        <canvas id="chart1"></canvas>
      </div>
      <div class="legend-custom">
        <div class="legend-item">
          <div class="legend-color" style="background: #16A34A;"></div>
          <span>High Probability (≥80%)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #D97706;"></div>
          <span>Moderate (50-80%)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #DC2626;"></div>
          <span>Low (<50%)</span>
        </div>
      </div>
    </div>

    <!-- Chart 2: Globex Range - BOTH Sides -->
    <div class="chart-container">
      <h3 class="chart-title">Globex Range - Probability of Breaking BOTH High AND Low</h3>
      <p class="chart-subtitle">How Range Size Impacts Two-Way Breakout Likelihood [n = 1,151]</p>
      <div class="chart-wrapper">
        <canvas id="chart2"></canvas>
      </div>
    </div>

    <!-- Chart 3: Pre-Market Range - ANY Breakout -->
    <div class="chart-container">
      <h3 class="chart-title">Pre-Market Range - Probability of ANY Breakout</h3>
      <p class="chart-subtitle">How Range Size Impacts the Likelihood of Breaking Out of Pre-Market High or Low [n = 1,151]</p>
      <div class="chart-wrapper">
        <canvas id="chart3"></canvas>
      </div>
    </div>

    <!-- Chart 4: Pre-Market Range - BOTH Sides -->
    <div class="chart-container">
      <h3 class="chart-title">Pre-Market Range - Probability of Breaking BOTH High AND Low</h3>
      <p class="chart-subtitle">How Range Size Impacts Two-Way Breakout Likelihood [n = 1,151]</p>
      <div class="chart-wrapper">
        <canvas id="chart4"></canvas>
      </div>
    </div>
  </div>

  <div class="section" style="margin-top: 64px;">
    <div class="section-title">Globex Range Breakout Analysis</div>
    <div class="section-desc">Probability of Breaking Globex High/Low During RTH Session [n = 1,361 Trading Days]</div>
    
    <div class="chart-container" style="max-width: 900px; margin: 0 auto 32px;">
      <div class="chart-wrapper" style="height: 450px;">
        <canvas id="breakoutChart"></canvas>
      </div>
    </div>

    <div class="table-wrap">
      <div class="table-header">Breakout Distribution</div>
      <table>
        <thead>
          <tr>
            <th>Outcome</th>
            <th class="right">Days</th>
            <th class="right">Probability</th>
            <th>Trading Context</th>
          </tr>
        </thead>
        <tbody>
          <tr style="background: rgba(22, 163, 74, 0.08);">
            <td><strong>Globex High Broken Only</strong></td>
            <td class="mono right">541</td>
            <td class="mono right">39.8%</td>
            <td>RTH broke above GX high, stayed above GX low</td>
          </tr>
          <tr style="background: rgba(220, 38, 38, 0.08);">
            <td><strong>Globex Low Broken Only</strong></td>
            <td class="mono right">439</td>
            <td class="mono right">32.3%</td>
            <td>RTH broke below GX low, stayed below GX high</td>
          </tr>
          <tr style="background: rgba(217, 119, 6, 0.08);">
            <td><strong>Both High & Low Broken</strong></td>
            <td class="mono right">321</td>
            <td class="mono right">23.6%</td>
            <td>RTH broke both levels</td>
          </tr>
          <tr style="background: rgba(107, 105, 100, 0.08);">
            <td><strong>Neither Broken (Range Day)</strong></td>
            <td class="mono right">60</td>
            <td class="mono right">4.4%</td>
            <td>RTH stayed within Globex range</td>
          </tr>
          <tr style="border-top: 2px solid var(--border-strong);">
            <td><strong>TOTAL</strong></td>
            <td class="mono right"><strong>1,361</strong></td>
            <td class="mono right"><strong>100.0%</strong></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="footer">
    <span>E-Mini S&P 500 Trading Edge Study · Globex & Pre-Market Analysis</span>
    <span>Source: ES Futures · 1,151 Days · Range as % of ADR</span>
  </div>

</div>

<script>
// Register the datalabels plugin
Chart.register(ChartDataLabels);

// Sample sizes for each bucket
const gxSamples = [33, 272, 338, 246, 134, 85, 43];
const pmSamples = [26, 389, 348, 250, 71, 44, 23];

// Common options
const commonOptions = {
  responsive: true,
  maintainAspectRatio: false,
  plugins: {
    legend: {
      display: false
    },
    tooltip: {
      enabled: false // Disable tooltips since we have labels
    },
    datalabels: {
      anchor: 'end',
      align: 'top',
      formatter: function(value, context) {
        // Show percentage on top of bar
        if (context.datasetIndex === 0) {
          return value.toFixed(1) + '%';
        }
        return null;
      },
      font: {
        family: 'JetBrains Mono',
        size: 11,
        weight: 600
      },
      color: '#1A1A18'
    }
  },
  scales: {
    y: {
      beginAtZero: true,
      grid: {
        color: '#E8E6E1',
        drawBorder: false
      },
      ticks: {
        color: '#6B6964',
        font: {
          family: 'DM Sans',
          size: 11
        },
        callback: function(value) {
          return value + '%';
        }
      }
    },
    x: {
      grid: {
        display: false
      },
      ticks: {
        color: '#6B6964',
        font: {
          family: 'DM Sans',
          size: 11
        }
      }
    }
  }
};

// Chart 1: Globex ANY Breakout
const chart1Data = {
  labels: ['0-30%', '30-50%', '50-70%', '70-90%', '90-110%', '110-150%', '>150%'],
  datasets: [
    {
      label: 'ANY Breakout',
      data: [100.0, 98.5, 98.2, 96.3, 96.3, 85.9, 72.1],
      backgroundColor: [
        '#16A34A', '#16A34A', '#16A34A', '#16A34A', '#16A34A', '#16A34A', '#D97706'
      ],
      borderColor: '#1A1A18',
      borderWidth: 1.5,
      datalabels: {
        anchor: 'end',
        align: 'top',
        offset: 4
      }
    },
    {
      label: 'Trend',
      data: [100.0, 98.5, 98.2, 96.3, 96.3, 85.9, 72.1],
      type: 'line',
      borderColor: '#1A1A18',
      borderWidth: 2.5,
      pointBackgroundColor: '#1A1A18',
      pointBorderColor: '#FFFFFF',
      pointBorderWidth: 2,
      pointRadius: 5,
      pointHoverRadius: 6,
      fill: false,
      tension: 0.3,
      datalabels: {
        display: false
      }
    },
    {
      label: 'Sample Size',
      data: gxSamples.map(() => null),
      datalabels: {
        anchor: 'end',
        align: 'bottom',
        offset: -20,
        formatter: function(value, context) {
          return 'n=' + gxSamples[context.dataIndex];
        },
        font: {
          family: 'JetBrains Mono',
          size: 10,
          weight: 500
        },
        color: '#9C9890'
      }
    }
  ]
};

new Chart(document.getElementById('chart1'), {
  type: 'bar',
  data: chart1Data,
  options: {
    ...commonOptions,
    scales: {
      ...commonOptions.scales,
      y: {
        ...commonOptions.scales.y,
        min: -15,
        max: 110
      }
    }
  }
});

// Chart 2: Globex BOTH Sides
const chart2Data = {
  labels: ['0-30%', '30-50%', '50-70%', '70-90%', '90-110%', '110-150%', '>150%'],
  datasets: [
    {
      label: 'BOTH Sides',
      data: [51.5, 38.2, 26.6, 17.5, 6.7, 7.1, 2.3],
      backgroundColor: [
        '#16A34A', '#D97706', '#D97706', '#DC2626', '#DC2626', '#DC2626', '#DC2626'
      ],
      borderColor: '#1A1A18',
      borderWidth: 1.5,
      datalabels: {
        anchor: 'end',
        align: 'top',
        offset: 4
      }
    },
    {
      label: 'Trend',
      data: [51.5, 38.2, 26.6, 17.5, 6.7, 7.1, 2.3],
      type: 'line',
      borderColor: '#1A1A18',
      borderWidth: 2.5,
      pointBackgroundColor: '#1A1A18',
      pointBorderColor: '#FFFFFF',
      pointBorderWidth: 2,
      pointRadius: 5,
      pointHoverRadius: 6,
      fill: false,
      tension: 0.3,
      datalabels: {
        display: false
      }
    },
    {
      label: 'Sample Size',
      data: gxSamples.map(() => null),
      datalabels: {
        anchor: 'end',
        align: 'bottom',
        offset: -14,
        formatter: function(value, context) {
          return 'n=' + gxSamples[context.dataIndex];
        },
        font: {
          family: 'JetBrains Mono',
          size: 10,
          weight: 500
        },
        color: '#9C9890'
      }
    }
  ]
};

new Chart(document.getElementById('chart2'), {
  type: 'bar',
  data: chart2Data,
  options: {
    ...commonOptions,
    scales: {
      ...commonOptions.scales,
      y: {
        ...commonOptions.scales.y,
        min: -10,
        max: 60
      }
    }
  }
});

// Chart 3: Pre-Market ANY Breakout
const chart3Data = {
  labels: ['0-10%', '10-20%', '20-30%', '30-50%', '50-70%', '70-100%', '>100%'],
  datasets: [
    {
      label: 'ANY Breakout',
      data: [100.0, 100.0, 100.0, 100.0, 100.0, 93.2, 82.6],
      backgroundColor: [
        '#16A34A', '#16A34A', '#16A34A', '#16A34A', '#16A34A', '#16A34A', '#D97706'
      ],
      borderColor: '#1A1A18',
      borderWidth: 1.5,
      datalabels: {
        anchor: 'end',
        align: 'top',
        offset: 4
      }
    },
    {
      label: 'Trend',
      data: [100.0, 100.0, 100.0, 100.0, 100.0, 93.2, 82.6],
      type: 'line',
      borderColor: '#1A1A18',
      borderWidth: 2.5,
      pointBackgroundColor: '#1A1A18',
      pointBorderColor: '#FFFFFF',
      pointBorderWidth: 2,
      pointRadius: 5,
      pointHoverRadius: 6,
      fill: false,
      tension: 0.3,
      datalabels: {
        display: false
      }
    },
    {
      label: 'Sample Size',
      data: pmSamples.map(() => null),
      datalabels: {
        anchor: 'end',
        align: 'bottom',
        offset: -20,
        formatter: function(value, context) {
          return 'n=' + pmSamples[context.dataIndex];
        },
        font: {
          family: 'JetBrains Mono',
          size: 10,
          weight: 500
        },
        color: '#9C9890'
      }
    }
  ]
};

new Chart(document.getElementById('chart3'), {
  type: 'bar',
  data: chart3Data,
  options: {
    ...commonOptions,
    scales: {
      ...commonOptions.scales,
      y: {
        ...commonOptions.scales.y,
        min: -15,
        max: 110
      }
    }
  }
});

// Chart 4: Pre-Market BOTH Sides
const chart4Data = {
  labels: ['0-10%', '10-20%', '20-30%', '30-50%', '50-70%', '70-100%', '>100%'],
  datasets: [
    {
      label: 'BOTH Sides',
      data: [76.9, 72.8, 66.7, 53.2, 28.2, 27.3, 4.3],
      backgroundColor: [
        '#16A34A', '#16A34A', '#16A34A', '#D97706', '#DC2626', '#DC2626', '#DC2626'
      ],
      borderColor: '#1A1A18',
      borderWidth: 1.5,
      datalabels: {
        anchor: 'end',
        align: 'top',
        offset: 4
      }
    },
    {
      label: 'Trend',
      data: [76.9, 72.8, 66.7, 53.2, 28.2, 27.3, 4.3],
      type: 'line',
      borderColor: '#1A1A18',
      borderWidth: 2.5,
      pointBackgroundColor: '#1A1A18',
      pointBorderColor: '#FFFFFF',
      pointBorderWidth: 2,
      pointRadius: 5,
      pointHoverRadius: 6,
      fill: false,
      tension: 0.3,
      datalabels: {
        display: false
      }
    },
    {
      label: 'Sample Size',
      data: pmSamples.map(() => null),
      datalabels: {
        anchor: 'end',
        align: 'bottom',
        offset: -14,
        formatter: function(value, context) {
          return 'n=' + pmSamples[context.dataIndex];
        },
        font: {
          family: 'JetBrains Mono',
          size: 10,
          weight: 500
        },
        color: '#9C9890'
      }
    }
  ]
};

new Chart(document.getElementById('chart4'), {
  type: 'bar',
  data: chart4Data,
  options: {
    ...commonOptions,
    scales: {
      ...commonOptions.scales,
      y: {
        ...commonOptions.scales.y,
        min: -12,
        max: 85
      }
    }
  }
});

// Breakout Chart - Simple bar chart for overall distribution
const breakoutData = {
  labels: [
    'Globex High Only\n(High Broken)',
    'Globex Low Only\n(Low Broken)',
    'BOTH\n(Both Broken)',
    'NEITHER\n(Range Day)'
  ],
  datasets: [
    {
      label: 'Probability',
      data: [39.8, 32.3, 23.6, 4.4],
      backgroundColor: ['#16A34A', '#DC2626', '#D97706', '#9C9890'],
      borderColor: '#1A1A18',
      borderWidth: 1.5
    }
  ]
};

new Chart(document.getElementById('breakoutChart'), {
  type: 'bar',
  data: breakoutData,
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: false
      },
      tooltip: {
        enabled: false
      },
      datalabels: {
        anchor: function(context) {
          // For the small bar, put label on top. For big bars, put it on top too
          return 'end';
        },
        align: function(context) {
          return 'top';
        },
        offset: 4,
        formatter: function(value, context) {
          const days = [541, 439, 321, 60];
          const index = context.dataIndex;
          if (index < 3) {
            // For the first 3 bars, show both percentage and days
            return value + '%';
          } else {
            // For the last bar (NEITHER), just show percentage
            return value + '%';
          }
        },
        font: {
          family: 'JetBrains Mono',
          size: 14,
          weight: 700
        },
        color: '#1A1A18'
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        max: 45,
        grid: {
          color: '#E8E6E1',
          drawBorder: false
        },
        ticks: {
          color: '#6B6964',
          font: {
            family: 'DM Sans',
            size: 11
          },
          callback: function(value) {
            return value + '%';
          }
        }
      },
      x: {
        grid: {
          display: false
        },
        ticks: {
          color: '#6B6964',
          font: {
            family: 'DM Sans',
            size: 12,
            weight: 500
          }
        }
      }
    },
    animation: {
      onComplete: function() {
        const ctx = this.ctx;
        const chartArea = this.chartArea;
        const meta = this.getDatasetMeta(0);
        
        // Manually draw the day labels in the center of the first 3 bars
        const days = [541, 439, 321];
        ctx.save();
        ctx.font = '600 13px "JetBrains Mono"';
        ctx.fillStyle = '#FFFFFF';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        days.forEach((dayCount, i) => {
          if (i < 3) {
            const bar = meta.data[i];
            const x = bar.x;
            const y = bar.y + (chartArea.bottom - bar.y) / 2;
            
            // Draw background rounded rectangle
            const text = dayCount + ' days';
            const textWidth = ctx.measureText(text).width;
            const padding = 12;
            const rectWidth = textWidth + padding * 2;
            const rectHeight = 26;
            const radius = 6;
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
            ctx.beginPath();
            const rx = x - rectWidth / 2;
            const ry = y - rectHeight / 2;
            ctx.moveTo(rx + radius, ry);
            ctx.lineTo(rx + rectWidth - radius, ry);
            ctx.quadraticCurveTo(rx + rectWidth, ry, rx + rectWidth, ry + radius);
            ctx.lineTo(rx + rectWidth, ry + rectHeight - radius);
            ctx.quadraticCurveTo(rx + rectWidth, ry + rectHeight, rx + rectWidth - radius, ry + rectHeight);
            ctx.lineTo(rx + radius, ry + rectHeight);
            ctx.quadraticCurveTo(rx, ry + rectHeight, rx, ry + rectHeight - radius);
            ctx.lineTo(rx, ry + radius);
            ctx.quadraticCurveTo(rx, ry, rx + radius, ry);
            ctx.closePath();
            ctx.fill();
            
            // Draw text
            ctx.fillStyle = '#FFFFFF';
            ctx.fillText(text, x, y);
          }
        });
        
        ctx.restore();
      }
    }
  }
});
</script>

</body>
</html>
